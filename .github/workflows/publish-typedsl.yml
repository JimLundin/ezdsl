name: Publish typeDSL

on:
  workflow_dispatch:
    inputs:
      create_release:
        description: 'Create GitHub release'
        required: false
        default: 'false'
        type: boolean
      release_tag:
        description: 'Release tag (e.g., v0.1.0)'
        required: false
        type: string

jobs:
  publish:
    runs-on: ubuntu-latest
    environment: pypi
    permissions:
      id-token: write  # IMPORTANT: this permission is mandatory for trusted publishing
      contents: write  # Required for creating releases
    steps:
      - uses: actions/checkout@v5

      - name: Install UV
        uses: astral-sh/setup-uv@v7

      - name: Set up Python
        run: uv python install

      - name: Sync dependencies
        run: uv sync

      - name: Build package
        run: uv build

      - name: Publish to PyPI
        run: uv publish

      - name: Create GitHub Release
        if: ${{ inputs.create_release == true && inputs.release_tag != '' }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release create ${{ inputs.release_tag }} \
            --title "Release ${{ inputs.release_tag }}" \
            --generate-notes \
            dist/*